@use '../../../core/ui/utilities/utility-layout' as *;
@use '../../../core/ui/utilities/utility-text' as *;
@use '../../../core/ui/utilities/utility-shapes' as shapes;
@use '../../../core/ui/themes/default/baseColors';
@use '../../../core/ui/themes/default/_animations.scss';
@use 'sass:color';

.unit-combat-preview {
	--attacker-color-primary: white;
	--attacker-color-secondary: white;
	--target-color-primary: white;
	--target-color-secondary: black;
	--attacker-symbol: url('fs://game/core/ui/themes/default/img/leader_symbols/leader_symb_00.png');
	--target-symbol: url('fs://game/core/ui/themes/default/img/leader_symbols/leader_symb_06.png');
	--defeat-color: #{baseColors.$defeat-color};
	--stalemate-color: #{baseColors.$stalemate-color};
	--victory-color: #{baseColors.$victory-color};
	--outcome-color: var(--victory-color);
	--transition-base-time: .375s;
	--transition-default-ease-in: #{animations.$cubicOut};
	--transition-default-ease-out: #{animations.$cubicOut};
	pointer-events: none;
	position: relative;
	align-items: center;
	justify-content: center;
	transform-origin: center;

	&.visible {
		>.main-container {
			>.preview-modifier-container {
				opacity: 1;
				transform: translateX(pixels(0));
				transition-delay: .5s;
				transition-timing-function: var(--transition-default-ease-in);
			}

			>.preview-header {
				opacity: 1;
				transform: translateY(pixels(0));
				transition-delay: 0s;
				transition-timing-function: var(--transition-default-ease-in);

				>.preview-banner-container {

					// stylelint-disable-next-line selector-max-combinators -- TODO: fix this
					>.preview-banner {
						opacity: 1;
						transition-delay: 0s;
						transition-timing-function: var(--transition-default-ease-in);

						// stylelint-disable-next-line selector-max-combinators -- TODO: fix this
						&.preview-banner-right {
							transition-delay: 0s;
						}
					}
				}

				>.preview-leader-icon-container {

					// stylelint-disable-next-line selector-max-combinators -- TODO: fix this
					>.preview-leader-icon {
						opacity: 1;
						transform: translateX(pixels(0)) translateY(pixels(0));
						transition-delay: 0s;
						transition-timing-function: var(--transition-default-ease-in);
					}
				}

				>.preview-outcome {
					opacity: 1;
					transform: translateY(pixels(0));
					transition-delay: 0s;
					transition-timing-function: var(--transition-default-ease-in);
				}
			}
		}


	}

	>.main-container {
		display: flex;
		flex-direction: row;
		position: relative;
		justify-content: center;
		align-items: flex-start;
		height: auto;
		padding-top: pixels(20);

		>.preview-header {
			position: absolute;
			top: pixels(0);
			height: pixels(216);
			width: pixels(228);
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: flex-start;
			transition-property: transform, opacity;
			transition-duration: var(--transition-base-time), .125s;
			transform: translateY(pixels(0));

			>.preview-bg {
				position: absolute;
				bottom: pixels(18);
				background-repeat: no-repeat;
				background-image: url("fs://game/hud_combat-prev_center.png");
				background-size: cover;
				transform: scale(1);
				width: pixels(192);
				height: pixels(216);

				// stylelint-disable-next-line selector-max-combinators -- TODO: fix this
				>.preview-vs-label {
					position: relative;
					display: flex;
					flex-direction: column;
					justify-content: center;
					align-items: center;
					height: pixels(24);
					width: 100%;
					font-size: pixels-font(12);
					text-align: center;
					line-height: pixels(24);
					padding-left: pixels(1);
					margin-top: pixels(78);
				}
			}

		}

		>.modifier-container {
			display: flex;
			flex-direction: column;
			position: absolute;
			justify-content: flex-start;
			background-color: var(--clr-hud-ornament__tint);
			height: pixels(192);
			width: pixels(272);
			top: pixels(16);
			left: pixels(-184);
			text-align: left;

			&.right {
				left: pixels(168);
				text-align: right;
			}

			>.unit-name {
				font-size: pixels-font(24);
				text-align: center;
			}

			>.modifier-text {
				font-size: pixels-font(16);
			}
		}
	}
}

.preview-health-meter-container {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
	align-self: center;
	position: absolute;
	width: pixels(60);
	height: pixels(65);
	bottom: pixels(40);
}

.preview-health-meter {
	position: relative;
	height: 100%;
	width: pixels(12);
	background-color: transparent;
	transform-origin: 100% 100%;
	transform: skewY(30deg);
	border-style: solid;
	border-width: pixels(1);

	&.preview-health-right {
		transform-origin: 0% 100%;
		transform: skewY(-30deg);
	}
}

.preview-max-health {
	position: relative;
	height: 100%;
	width: 100%;
	bottom: 0%;
	background-color: transparent;
}

.preview-actual-health {
	position: absolute;
	height: 100%;
	width: 100%;
	bottom: 0%;
	background-color: baseColors.$low-health-color;
	animation-name: health-flash;
	animation-duration: .5s;
	animation-direction: alternate;
	animation-iteration-count: infinite;
	animation-timing-function: ease-in;

	@keyframes health-flash {
		0% {
			opacity: 1;
		}

		100% {
			opacity: .375;
		}
	}
}

.preview-simulated-health {
	position: absolute;
	height: 100%;
	width: 100%;
	bottom: 0%;
	background-color: baseColors.$full-health-color;
}

.preview-banner-container {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
	align-items: flex-start;
	position: absolute;
	width: pixels(228);
	height: pixels(154);
	top: pixels(18);
}

.preview-banner {
	position: relative;
	display: flex;
	justify-content: center;
	align-items: center;
	transition-property: transform, opacity;
	transition-duration: var(--transition-base-time), .125s;
	transform: translateX(pixels(0)) translateY(pixels(0));

	&.preview-banner-right {
		transform: translateX(pixels(0)) translateY(pixels(0));

		>.preview-banner-bg {
			left: auto;
			filter: fxs-color-tint(var(--target-color-primary));
			transform: scaleX(-1);
		}

		>.preview-banner-stat-container {
			left: auto;
		}
	}
}

.preview-banner-bg {
	position: relative;
	display: flex;
	justify-content: center;
	width: pixels(84);
	height: pixels(168);
	transform: scale(1);
	background-image: url("fs://game/hud_combat-prev_banner.png");
	background-repeat: no-repeat;
	background-size: cover;
	filter: fxs-color-tint(var(--attacker-color-primary));
}

.preview-banner-bars {
	display: flex;
	width: pixels(42);
	justify-content: center;
	background-size: contain;
	background-repeat: no-repeat;
	background-image: url("fs://game/hud_combat-prev_banner-stripes.png");
}

.preview-banner-stat-container {
	position: absolute;
	display: flex;
	flex-direction: column;
	align-self: center;
	align-items: center;
}

.preview-unit-icon {
	background-color: var(--attacker-color-primary);
	border-top-color: var(--attacker-color-secondary);
	border-right-color: var(--attacker-color-secondary);
	border-bottom-color: var(--attacker-color-secondary);
	border-left-color: var(--attacker-color-secondary);
	fxs-background-image-tint: var(--attacker-color-secondary);

	&.preview-unit-icon-right {
		background-color: var(--target-color-primary);
		border-top-color: var(--target-color-secondary);
		border-right-color: var(--target-color-secondary);
		border-bottom-color: var(--target-color-secondary);
		border-left-color: var(--target-color-secondary);
		fxs-background-image-tint: var(--target-color-secondary);
	}

}

.preview-stat-icon {
	width: pixels(24);
	height: pixels(24);
	background-size: contain;
	background-repeat: no-repeat;
	margin-top: pixels(3);
}

.preview-stat-number {
	display: flex;
	flex-direction: column;
	justify-content: center;
	align-items: center;
	font-weight: bold;
	line-height: pixels(24);
	margin-top: pixels(-8);
	font-size: pixels-font(17);
}

.preview-outcome {
	display: flex;
	flex-direction: column;
	justify-content: center;
	position: absolute;
	width: pixels(162);
	height: pixels(84);
	top: pixels(3);
	transition-property: transform, opacity;
	transition-duration: var(--transition-base-time), .125s;
	transform: translateY(pixels(0));
	background-image: url("fs://game/hud_combat-prev_top-bg.png");
	background-repeat: no-repeat;
	background-size: cover;

	&.preview-outcome-victory {
		fxs-background-image-tint: color.change(baseColors.$victory-color, $alpha: 1);
	}

	&.preview-outcome-stalemate {
		fxs-background-image-tint: color.change(baseColors.$stalemate-color, $alpha: 1);
	}

	&.preview-outcome-defeat {
		fxs-background-image-tint: color.change(baseColors.$defeat-color, $alpha: 1);
	}
}

.preview-outcome-color-bg {
	display: flex;
	height: 100%;
	background-repeat: no-repeat;
	background-size: cover;

	&.preview-outcome-victory {
		background-image: radial-gradient(color.change(baseColors.$victory-color, $alpha: 1), color.change(baseColors.$victory-color, $alpha: 0));
	}

	&.preview-outcome-stalemate {
		background-image: radial-gradient(color.change(baseColors.$stalemate-color, $alpha: 1), color.change(baseColors.$stalemate-color, $alpha: 0));
	}

	&.preview-outcome-defeat {
		background-image: radial-gradient(color.change(baseColors.$defeat-color, $alpha: 1), color.change(baseColors.$defeat-color, $alpha: 0));
	}
}

.preview-outcome-label {
	position: relative;
	display: flex;
	flex-direction: flex-start;
	justify-content: center;
	min-width: pixels(120);
	width: auto;
	height: pixels(48);
	flex: 1 0;

}

.preview-outcome-text {
	display: flex;
	flex-direction: column;
	justify-content: center;
	align-items: flex-start;
	text-align: center;
	font-size: pixels-font(16);
	line-height: pixels(20);
	height: pixels(35);
}

.preview-leader-icon-container {
	position: absolute;
	width: pixels(82);
	height: pixels(40);
	display: flex;
	flex-direction: row;
	justify-content: space-between;
	top: pixels(30);
}

.preview-leader-icon {
	position: relative;
	display: flex;
	flex-direction: column;
	justify-content: center;
	align-items: center;
	height: pixels(40);
	width: pixels(40);
	transition-property: transform, opacity;
	transition-duration: var(--transition-base-time), .125s;
}

.preview-hex-bg {
	position: absolute;
	width: pixels(32);
	height: pixels(42);
	right: pixels(2);
	top: pixels(4);
	background-image: url("fs://game/hud_diplo_hex.png");
	fxs-background-image-tint: var(--attacker-color-primary);
	background-repeat: no-repeat;
	background-size: contain;
	transform: scale(1);


	&.preview-hex-target {
		fxs-background-image-tint: var(--target-color-primary);
		right: pixels(5);
	}
}

.preview-icon-img {
	position: absolute;
	width: 100%;
	height: 100%;
	bottom: pixels(-1);
	background-size: contain;
	background-repeat: no-repeat;
	clip-path: shapes.$hex-icon-mask;
}

.preview-modifier-container {
	position: relative;
	display: flex;
	flex-direction: column;
	justify-content: flex-start;
	border-image-source: url("fs://game/hud_unit-panel_box-bg");
	border-image-slice: 30 20 30 20 fill;
	border-image-width: auto;
	border-image-outset: 17 13 17 13;
	min-height: pixels(60);
	width: pixels(288);
	transition-property: transform, opacity;
	transition-duration: var(--transition-base-time), .25s;
	margin-right: pixels(70);

	text-align: right;

	&.preview-modifier-right {
		text-align: left;
		margin-right: pixels(0);
		margin-left: pixels(70);

		>.preview-modifier-info {
			>.preview-unit-name {
				padding: pixels(5) pixels(0) pixels(5) pixels(30);
			}

			>.preview-modifier-text {
				padding: pixels(0) pixels(12) pixels(0) pixels(30);
			}
		}
	}
}

.preview-modifier-info {
	display: flex;
	flex-direction: column;
	justify-content: flex-start;
	align-items: flex-start;
	padding: pixels(17) pixels(25) pixels(17) pixels(13);
	margin-bottom: pixels(12);
}

.preview-unit-name {
	font-size: pixels-font(16);
	line-height: pixels(20);
	color: #ffbadd;
	padding: pixels(5) pixels(0) pixels(5) pixels(12);
}

.preview-header-divider {
	display: flex;
	width: 100%;
	height: pixels(16);
	border-image-source: url("fs://game/hud_section-line");
	border-image-width: auto;
	border-image-slice: 12 32 2 32;
}

.preview-modifier-text {
	font-weight: bold;
	font-size: pixels-font(17);
	text-align: left;
	align-self: flex-start;
	padding-left: pixels(12);
}

.combat-preview__banner-rod-left {
	position: absolute;
	left: pixels(0);
	background-image: url("fs://game/hud_combat-prev_pole.png");
	background-repeat: no-repeat;
	background-size: contain;
	width: pixels(120);
	height: pixels(74);
}


.combat-preview__banner-rod-right {
	position: absolute;
	right: pixels(0);
	transform: rotateY(180deg);
	background-image: url("fs://game/hud_combat-prev_pole.png");
	background-repeat: no-repeat;
	background-size: contain;
	width: pixels(120);
	height: pixels(74);
}

.combat-preview__banner-rod-dot {
	position: absolute;
	background-image: url("fs://game/hud_combat-prev_pole-dot.png");
	background-repeat: no-repeat;
	background-size: contain;
	background-position: center;
	width: pixels(16);
	height: pixels(16);
	top: pixels(56);
	left: pixels(106);
}
@use '../../../core/ui/utilities/utility-layout' as *;
@use '../../../core/ui/utilities/utility-text' as *;
@use '../../../core/ui/utilities/utility-shapes' as shapes;
@use '../../../core/ui/themes/default/baseColors';
@use '../../../core/ui/themes/default/animations';
@use '../../../core/ui/themes/default/theme';

.diplo-ribbon {
	// Colors
	--player-color-primary: rgb(17, 46, 92);
	--player-color-secondary: rgb(255, 234, 105);
	pointer-events: none;
	overflow: visible;

	// This is a stop-gap to prevent the sizing bugs commonly seen in the diplo-ribbon.
	// This will be removed when the proper UI2 images and DOM structure is put in.
	font-size: pixels(8);

	&.primary-color-is-lighter {
		.diplo-ribbon__top-bar-bg {
			background-image: linear-gradient(to left, var(--player-color-secondary-text) 0%, var(--player-color-secondary-more) 100%);
		}

		.diplo-ribbon__top-bar-overlay {
			background-image: linear-gradient(195deg, theme.color('accent-1', .25) 0%, theme.color('accent-6', .125) 100%);
		}
	}

	&.hidden {
		display: none;
	}

	&.diplomacy-dialog-ribbon {
		fxs-nav-help {
			display: none;
		}
	}

	&.local-player-diplomacy-hub-ribbon {
		@media (max-width: pixels(1920)) {
			top: pixels(30);
			right: pixels(130);
		}

		@media (max-width: pixels(1600)) {
			top: pixels(30);
			right: pixels(300);
		}

		right: pixels(100);
	}

	&.other-player-diplomacy-hub-ribbon {
		@media (max-width: pixels(1920)) {
			top: pixels(30);
			right: pixels(-130);
		}

		@media (max-width: pixels(1600)) {
			top: pixels(30);
			right: pixels(-170);
		}

		right: pixels(-100);
	}
}

@keyframes diplo-ribbon__attention-anim {
	0% {
		transform: translateY(pixels(0));
	}

	60% {
		transform: translateY(pixels(-4));
	}

	90% {
		transform: translateY(pixels(-4));
	}

	100% {
		transform: translateY(pixels(0));
	}
}

.diplo-ribbon__team-overlay {
	background-image: url('fs://game/mp_hud_banner_teamcolor.png');
	background-size: 100% 100%;
	margin-top: pixels(-86);
	width: pixels(57);
	height: pixels(132);
}

.diplo-ribbon__team-text {
	margin-top: pixels(-49);
}

.diplo-ribbon__attribute-button {
	border-image-source: url("hud_att_arrow");
	border-image-slice: 1 1 2 2 fill;
	border-image-width: pixels(1) pixels(1) pixels(2) pixels(2);

	animation-name: diplo-ribbon__attention-anim;
	animation-duration: 2s;
	animation-iteration-count: infinite;
	animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);

	&.hidden {
		animation-iteration-count: 0;
	}

	&:hover {
		border-image-source: url("hud_att_arrow_highlight");
	}

}

.center {
	.diplo-ribbon__ribbon-container {
		&::before {
			content: '';
			width: 100%;
			height: 7em;
			max-height: pixels(70);
		}
	}
}

.diplo-ribbon__ribbon-container {
	display: flex;
	flex-direction: column;
	justify-content: flex-start;
	align-content: flex-start;
	position: relative;

	&::before {
		content: '';
		width: 100%;
		height: 5.625em;
		max-height: pixels(56.25);
	}
}

.diplo-ribbon__ribbon-container-small {
	@media (max-width: pixels(1600)) {
		right: pixels(-96);
	}
}

.diplo-ribbon__ribbon-container-hub {
	@media (max-width: pixels(1600)) {
		right: pixels(-64);
	}
}

.diplo-ribbon-outer {
	position: relative;
	// width: 12em;
	height: auto;
	justify-content: flex-start;
	align-items: flex-start;
	transform: translateX(pixels(0));
	align-self: flex-start;

	&::after {
		content: '';
		width: 1.5em;
		max-width: pixels(15);
		height: 100%;
		pointer-events: none;
	}

	&.primary-color-is-lighter {
		.diplo-ribbon__overlay {
			background-image: linear-gradient(240deg, rgba(236, 224, 212, .125) 0%, transparent 75%, rgba(10, 2, 13, .25) 100%);
		}

		.diplo-ribbon__folds {
			opacity: .3;
		}

		.diplo-ribbon__upper-shape {
			fxs-background-image-tint: var(--player-color-primary-more);
		}
	}

	&.show-on-hover {

		pointer-events: auto;

		.diplo-ribbon__yields,
		.diplo-ribbon__bottom-spacer,
		.diplo-ribbon__bg-container {
			display: none;
		}


		&:hover {

			.diplo-ribbon__yields,
			.diplo-ribbon__bottom-spacer,
			.diplo-ribbon__bg-container {
				display: flex;
			}
		}
	}

	&.hover-all {

		.diplo-ribbon__yields,
		.diplo-ribbon__bottom-spacer,
		.diplo-ribbon__bg-container {
			display: flex;
		}
	}
}

.diplo-ribbon__outer_small {
	@media (max-width: pixels(1918)) {
		margin-right: pixels(-8);
	}
}

.diplo-ribbon_content-container {
	position: relative;
	width: pixels(85);
	height: auto;
	display: flex;
	flex-direction: column;
	align-content: center;
	align-items: center;
	align-self: flex-start;
}

.diplo-ribbon__bg {
	border-image: url("hud_diployield_bg");
	border-image-slice: 62 23 0 23 fill;
	border-image-width: pixels(62) pixels(23) pixels(0) pixels(23);
}

/* TODO Bring back with group highlighting
.diplo-ribbon__bg-highlight:hover {
	border-image: url("hud_diployield_bg_hi");
	border-image-slice: 62 23 0 23 fill;
	border-image-width: pixels(62) pixels(23) pixels(0) pixels(23);
}
*/

.diplo-ribbon__tokens {
	position: relative;
	height: auto;
	z-index: 2;
	display: flex;
	flex-direction: column;
	align-items: center;
	height: 9.75em;
	max-height: pixels(97.5);
}

//TODO: END REMOVE

//==========================
// LEADER PORTRAIT
//==========================

.diplo-ribbon__portrait {
	--diplo-ribbon-scale: 1;
	position: absolute;
	align-self: center;
	width: 10.5em;
	max-width: pixels(105);
	height: 10.5em;
	max-height: pixels(105);
	transform: translateY(-30%) scale(var(--diplo-ribbon-scale));
	bottom: pixels(0);
	transition-duration: .25s;
	transition-property: bottom, transform;
	transition-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);
	pointer-events: none;

	@media (experience: mobile) {
		pointer-events: auto;
	}

	&.turn-active {
		bottom: pixels(10);

		.diplo-ribbon__portrait-turn {
			display: flex;
		}
	}

	&.hud-select-potential {
		width: 14em;
		max-width: pixels(140);
		height: 14em;
		max-height: pixels(140);

		&:focus {
			--diplo-ribbon-scale: 1.125;

			.diplo-ribbon__portrait-bg--focus {
				opacity: .875;
			}
		}
	}

	&:hover,
	&:focus {
		--diplo-ribbon-scale: 1.0625;

		.diplo-ribbon__portrait-shadow {
			transform: translateX(-2.5%) translateY(5%);
		}

		.diplo-ribbon__portrait-bg--highlight {
			opacity: .875;
		}
	}

	&.disabled {
		.diplo-ribbon__portrait-hitbox {
			pointer-events: none;
		}
	}
}

//Since these portraits are so close to the small buttons in the corner, a dedicated hitbox for pointer events helps keep them from overlapping
.diplo-ribbon__portrait-hitbox {
	position: absolute;
	width: 68.75%;
	height: 75%;
	pointer-events: auto;
}

.diplo-ribbon__portrait-shadow {
	background-image: url("fs://game/shadow_hex-icon.png");
	background-size: contain;
	background-position: center;
	background-repeat: no-repeat;
	transform: translateX(0%) translateY(0%);
	transition-property: transform;
	transition-duration: .25s;
	transition-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);
	pointer-events: none;
}

.diplo-ribbon__portrait-bg {
	background-image: url("fs://game/bg_hex-icon.png");
	background-size: contain;
	background-position: center;
	background-repeat: no-repeat;
	fxs-background-image-tint: var(--player-color-primary);
	pointer-events: none;
}

.diplo-ribbon__portrait-hex-bg {
	background-image: url("final_leader-hex");
	filter: fxs-color-tint(var(--player-color-secondary-accent));
}

.diplo-ribbon__portrait-hex-bg-frame {
	background-image: url("hud_diplo_hex-frame");
}

.diplo-ribbon__portrait-hex-bg-shadow {
	background-image: url("hud_diplo_hex-shadow");
}

.diplo-ribbon__portrait-bg--inner {
	background-image: url("fs://game/bg_hex-icon-inner.png");
	background-size: contain;
	background-position: center;
	background-repeat: no-repeat;
	fxs-background-image-tint: var(--player-color-secondary);
	pointer-events: none;
}

.diplo-ribbon__portrait-bg--highlight {
	background-image: url("fs://game/bg_hex-icon-inner.png");
	background-size: contain;
	background-position: center;
	background-repeat: no-repeat;
	fxs-background-image-tint: theme.color('accent-1');
	pointer-events: none;
	opacity: 0;
	transition-property: opacity;
	transition-duration: .25s;
	transition-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);
}

.diplo-ribbon__portrait-overlay {
	background-image: url("fs://game/overlay_hex-icon.png");
	background-size: contain;
	background-position: center;
	background-repeat: no-repeat;
}

.diplo-ribbon__portrait-image {
	top: -26.5%;
	transition-property: top;
	transition-duration: .25s;
	transition-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);
}

.diplo-ribbon__bottom-spacer {
	position: relative;
	height: 4.125em;
}

.radial-menu-mode {
	.relationship-icon {
		bottom: pixels(12);
		transform: scale(1.3);
	}
}

//==========================
// TOP-SECTION
//==========================

.diplo-ribbon__upper-shadow {
	position: absolute;
	top: -25%;
	left: 0;
	right: 0;
	bottom: -25%;
	background-image: url('fs://game/core/shadow_diplo-ribbon-top.png');
	background-position: center;
	background-size: contain;
	background-repeat: no-repeat;
}

.diplo-ribbon__front-banner {
	border-image-source: url('hud_frontbanner');
	border-image-slice: 14 11 16 9 fill;
	border-image-width: pixels(14) pixels(11) pixels(16) pixels(9);
	//filter: fxs-color-tint(var(--player-color-primary-more));
	fxs-border-image-tint: var(--player-color-primary-more);
}

.diplo-ribbon__front-banner-shadow {
	border-image: url('hud_frontbanner_overlay');
	border-image-slice: 7 4 9 2 fill;
	border-image-width: pixels(7) pixels(4) pixels(9) pixels(2);
}

.diplo-ribbon__front-banner-overlay {
	border-image: url('hud_frontbanner_shadow');
	border-image-slice: 14 11 16 9 fill;
	border-image-width: pixels(14) pixels(11) pixels(16) pixels(9);
}

.diplo-ribbon__symbol {
	filter: fxs-color-tint(var(--player-color-secondary));
}

.diplo-ribbon__relation-container {
	position: absolute;
	top: pixels(0);
	display: flex;
	flex-direction: column;
	justify-content: flex-start;
	align-items: center;
	align-self: center;

	&::before {
		content: '';
		position: relative;
		height: 7.5em;
		max-height: pixels(75);
	}
}

//==========================
// ICONS
//==========================

.relationship-icon {
	margin-bottom: -20%;
}

.diplo-ribbon__sanction-envoy-count {
	color: theme.color("white");
	background-color: theme.color("accent");
	width: pixels(42);
}

.diplo-ribbon__war-support-count {
	color: theme.color("white");
	background-color: theme.color("accent");
	width: pixels(42);

	&.positive {
		color: theme.color("white");
		background-color: theme.color("positive-light");
	}

	&.negative {
		color: theme.color("white");
		background-color: theme.color("negative-light");
	}
}

.yield-item {
	padding-right: pixels(3);
}

.yield-label {
	pointer-events: none;

	>img {
		width: 1em;
		height: 1em;
	}
}

.size-item {
	width: 33.3%;
	display: flex;
	flex-direction: column;
	flex-wrap: wrap;
	justify-content: flex-start;
	align-items: center;
	align-self: flex-start;
	background-image: linear-gradient(to bottom, var(--player-color-primary-accent) 0, var(--player-color-primary-accent).125em, transparent .125em),
		linear-gradient(to top, var(--player-color-primary-accent) 0, var(--player-color-primary-accent).125em, transparent .125em);
	padding-bottom: .375em;

	.yield-label {
		margin-bottom: .375em;
	}
}